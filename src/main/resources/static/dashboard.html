<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - MyBooks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
</head>
<body class="bg-gradient-to-br from-green-400 to-orange-500 min-h-screen">

<!-- NAVBAR -->
<nav class="bg-white shadow-lg">
    <div class="container mx-auto px-6 py-4">
        <div class="flex justify-between items-center">
            <div class="text-2xl font-bold text-green-600">
                üìö MyBooks
            </div>

            <!-- NAVIGATION LINKS -->
            <div class="flex space-x-4">
                <a href="/dashboard.html" class="text-gray-700 hover:text-green-600">Dashboard</a>
                <a href="/books.html" class="text-gray-700 hover:text-green-600">Books</a>
                <a href="/notes.html" class="text-gray-700 hover:text-green-600">Notes</a>
            </div>

            <!-- LOGOUT BUTTON -->
            <button id="logoutButton" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded transition">
                Logout
            </button>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container mx-auto px-6 py-8">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Welcome to Dashboard</h1>

        <!-- Stats or Content Here -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-green-100 p-6 rounded-lg">
                <h3 class="text-xl font-semibold text-green-800">Books</h3>
                <p class="text-3xl font-bold text-green-600" id="bookCount">0</p>
            </div>

            <div class="bg-orange-100 p-6 rounded-lg">
                <h3 class="text-xl font-semibold text-orange-800">Notes</h3>
                <p class="text-3xl font-bold text-orange-600" id="noteCount">0</p>
            </div>

            <div class="bg-blue-100 p-6 rounded-lg">
                <h3 class="text-xl font-semibold text-blue-800">Profile</h3>
                <p class="text-sm text-blue-600" id="userEmail">Loading...</p>
            </div>
        </div>
    </div>
</div>

<!-- LOGOUT SCRIPT -->
<script>
    // ==========================================
    // LOGOUT FUNCTIONALITY
    // ==========================================

    document.addEventListener("DOMContentLoaded", function() {
        console.log("üìÑ Dashboard loaded");

        // Find logout button
        const logoutButton = document.getElementById("logoutButton");

        if (logoutButton) {
            console.log(" Logout button found");

            // Add click event
            logoutButton.addEventListener("click", async function(e) {
                e.preventDefault();

                console.log(" Logout initiated");

                try {
                    // Send logout request to backend
                    console.log("üì§ Sending logout request...");

                    const response = await fetch("/api/auth/logout", {
                        method: "POST",
                        credentials: "include",
                        headers: {
                            "Content-Type": "application/json"
                        }
                    });

                    console.log("üì• Response status:", response.status);

                    if (response.ok) {
                        const data = await response.json();
                        console.log("‚úÖ Logout successful:", data);
                    } else {
                        console.warn("‚ö†Ô∏è Logout response not OK:", response.status);
                    }

                } catch (error) {
                    console.error("‚ùå Logout error:", error);
                } finally {
                    // Always cleanup and redirect
                    console.log("üßπ Cleaning up...");

                    // Clear storage
                    try {
                        localStorage.clear();
                        sessionStorage.clear();
                        console.log("üóëÔ∏è Storage cleared");
                    } catch (e) {
                        console.warn("‚ö†Ô∏è Storage clear error:", e);
                    }

                    // Redirect to login
                    console.log("üîÑ Redirecting to login...");
                    window.location.href = "/login.html";
                }
            });

        } else {
            console.error("‚ùå Logout button not found! Check ID: 'logoutButton'");
        }

        // ==========================================
        // LOAD USER INFO (Optional)
        // ==========================================
        loadUserInfo();
    });

    // Load user information
    async function loadUserInfo() {
        try {
            const response = await fetch("/api/auth/me", {
                credentials: "include"
            });

            if (response.ok) {
                const user = await response.json();
                document.getElementById("userEmail").textContent = user.email;
            } else {
                // Not authenticated, redirect to login
                window.location.href = "/login.html";
            }
        } catch (error) {
            console.error("Failed to load user info:", error);
        }
    }

    // Load stats (Optional)
    async function loadStats() {
        try {
            // Load book count
            const booksResponse = await fetch("/api/books", {
                credentials: "include"
            });
            if (booksResponse.ok) {
                const books = await booksResponse.json();
                document.getElementById("bookCount").textContent = books.length;
            }

            // Load note count
            const notesResponse = await fetch("/api/notes", {
                credentials: "include"
            });
            if (notesResponse.ok) {
                const notes = await notesResponse.json();
                document.getElementById("noteCount").textContent = notes.length;
            }
        } catch (error) {
            console.error("Failed to load stats:", error);
        }
    }

    // Load stats on page load
    loadStats();
</script>

</body>
</html>